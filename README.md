# Record-Replay Mock Creator

Create Mockito java code by replaying executions.

Let's say you have a dependency with random behavior

```java
import java.util.Random;

public class Dice {
    public Dice(){}

    public int roll() {
        return new Random().nextInt(6) + 1;
    }
}
```

It would be nice to have some way to generate the following code by recording a real object.

```java
public class MockDiceCreator {
  public Dice create() {
    Dice mockDice = Mockito.mock(Dice.class);
    doReturn(2)
            .doReturn(3)
            .doReturn(3)
            .when(mockDice)
            .roll();
    return mockDice;
  }
}
```
Good news!
This package enables you to do so!

The code above was generated by this example
```java
import org.katie.orange.core.Listener;
import org.katie.orange.core.CodeSynthesizer;

public class Main {
    public static void main(String[] args) {

        Dice dice = new Dice();

        Listener listener = new Listener();
        Dice wrappedDice = listener.wrap(dice);
        for (int i = 1; i <= 5; i++) {
            wrappedDice.roll();
        }
        CodeSynthesizer synth = new CodeSynthesizer("org.katie.orange.examples", "create");
        System.out.println(synth.generateMockito(listener));
    }
}
```

There are 2 modifications required.
1. Wrapping the target object with a `Listener`
2. Generating the code with a `CodeSynthesizer`

That's it!

Of course, it's not useful to only return primitives. Orange mocks the objects recursively.

For example, having a object

```java

import java.net.http.HttpResponse;

public class Main2 {
    public static void main(String[] args) {
        HttpClient client = new HttpClient();
        HttpResponse response = client.get();
        String body = response.getBody();
        System.out.println(body);
    }
}
```
Orange can generate the following code by listening to HttpClient



```java
public class MockHttpClientCreator {
  public static HttpClient create() {
    String string_d510 = "Hello World!";
    HttpResponse mockHttpResponse_047e = Mockito.mock(HttpResponse.class);
    doReturn(string_d510).when(mockHttpResponse_047e).getBody();
    HttpClient mockHttpClient_c11e = Mockito.mock(HttpClient.class);
    doReturn(mockHttpResponse_047e).when(mockHttpClient_c11e).get();
    return mockHttpClient_c11e;
  }
}
```

As long as your program ends, this tree is will be finite, also the leaf nodes return void or a primitive data type.

This means that Orange can mock almost any java object! (As long as there are no final classes involved)

### Recording throws

Yes, Orange will also record and chain `doThrow`

## Recording methods with side effects

Coming soon

